console.log("top");

$(document).ready(function (){

	console.log("bottom");


	console.log("tokbox js started");


	// replace these values with those generated in your TokBox Account
	var apiKey = "46445792";
	


	

	var publisher;
    //var streams = [];
    
    var watchers = 0;
	var streamers = 0;
	

	console.log(token +"============token");
	console.log(api_key+"==========api_key");
	console.log(session_id+"==================session_id");




	// (optional) add server code here
	initializeSession();



	// Handling all of our errors here by alerting them
	function handleError(error) {
	  if (error) {
	    alert(error.message);
	  }
	}



	function initializeSession() {
		
		if (OT.checkSystemRequirements() == 0) {

			console.log("The client does not support WebRTC.");

		}else {

			var session = OT.initSession(api_key, session_id);

			// Connect to the session
			session.connect(token, function(error) {
				// If the connection is successful, publish to the session
				if (error) {
					//handleError(error);
					console.log("Session.connect error");
					if (error.name === "OT_NOT_CONNECTED") {
				      alert("You are not connected to the internet. Check your network connection.");
				    }

				} else {
					session.publish(publisher, handleError);
					console.log("Session.connect else");
				}
			});


			

			// Subscribe to a newly created stream
			session.on('streamCreated', function(event) {
				session.subscribe(event.stream, 'subscriber', {
				insertMode: 'append',
				width: '100%',
				height: '100%'
				}, handleError);
			});

			
			// Create a publisher
			var publisher = OT.initPublisher('publisher', {
				insertMode: 'append',
				width: '100%',
				height: '100%'
			}, handleError);

			
			

		}
	}

});
